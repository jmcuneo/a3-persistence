const makeGuestList=function(e){let t=new Set,n=document.getElementById("guestList");n.innerHTML="",e.forEach(e=>{if(!t.has(e.name)){t.add(e.name);let a=document.createElement("li");a.innerHTML=e.name,a.classList.add("list-group-item"),n.appendChild(a)}})},resetTextBoxes=function(){document.querySelector("#youritem").value="",document.querySelector("#itemPrice").value="",document.querySelector("#numItems").value="",document.querySelector("#suggestItem").value="",document.querySelector("#suggestQty").value=""},addToTable=function(e){let t=document.getElementById("table"),n=`<tr id="entryRow">
                <td>${e.tableId}</td>
                <td>${e.name}</td>
                <td>${e.item}</td>
                <td>${e.qty}</td>
                <td>${e.cost}</td>
                <td><button class="remove">Remove</button></td>
              </tr>`;t.insertAdjacentHTML("beforeend",n);let a=t.querySelector(".remove:last-child");a.addEventListener("click",function(e){e.preventDefault()}),resetTextBoxes()},generateTable=function(e){for(let t=0;t<=e.length;t++)void 0!=document.getElementById("guestName")&&document.getElementById("guestName").remove(),void 0!=document.getElementById("entryRow")&&document.getElementById("entryRow").remove();for(let n=0;n<e.length;n++)addToTable(e[n]);makeGuestList(e)};function isEmpty(e){return!e||0===e.length}const makeTable=function(e){for(let t=0;t<e.length;t++){let n=e[t];console.log("type of entry: ",typeof e[t].Sitem),console.log("entry item: ",e[t].Sitem);let a=document.getElementById("tableSuggest"),l=`<tr id="suggestRow">
              <td>${n.Sitem}</td>
              <td>${n.Sqty}</td>
              <td><button class="bring">Bring</button></td>
            </tr>`;a.insertAdjacentHTML("beforeend",l);let i=a.querySelector(".bring:last-child");i.addEventListener("click",function(e){e.preventDefault()})}},clearSuggest=function(e){if(document.getElementById("suggestRow"))for(let t=0;t<e.length-1;t++)document.getElementById("suggestRow").remove()},submit=async function(e){e.preventDefault();let t=document.querySelector("#youritem"),n=document.querySelector("#itemPrice"),a=document.querySelector("#numItems");if(isEmpty(t.value)||isEmpty(a.value)){alert("Please fill out all fields. If the price is unknown, you may leave it blank.");return}let l=createEntry(t.value,n.value,a.value),i=await fetch("/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await i.json(),r=o.appdata,s=o.suggestdata,g=r[r.length-1];for(let u=0;u<s.length;u++)s[u].Sitem==g.item&&s[u].Sqty==g.qty&&(bring(u),remove(r.length),console.log("item removed from bring and added to appdata: ",s[u]));generateTable(r),resetTextBoxes()},createEntry=function(e,t,n){return{item:e,price:t,qty:n}},createSuggest=function(e,t){return{Sitem:e,Sqty:t}},refreshPage=async function(){let e=await fetch("/refresh",{method:"POST",body:""}),t=await e.json(),n=t.appdata,a=t.suggestdata;generateTable(n),console.log("suggest ",a),clearSuggest(a),makeTable(a),console.log("page refreshed.")},remove=async function(e){let t=await fetch("/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entryIndex:e})}),n=await t.json();"string"==typeof n?alert(n):generateTable(n)},suggest=async function(e){e.preventDefault();let t=document.querySelector("#suggestItem"),n=document.querySelector("#suggestQty");if(isEmpty(t.value)||isEmpty(n.value)){alert("Please fill out all fields. If the quantity is unknown, you may leave it blank.");return}let a=createSuggest(t.value,n.value),l=await fetch("/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await l.json();"string"==typeof i?alert(i):(i[i.length-1],clearSuggest(i),makeTable(i),resetTextBoxes())},bring=async function(e){let t=await fetch("/bring",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggestIndex:e})}),n=await t.json(),a=n.appdata,l=n.suggestdata;addToTable(a[a.length-1]);for(let i=0;i<=l.length;i++)document.getElementById("suggestRow").remove();clearSuggest(l),makeTable(l)},logout=async function(e){e.preventDefault(),await fetch("/logout",{method:"GET"}).then(e=>{window.location.href="/"})},edit=async function(e){console.log("EDIT"),e.preventDefault();let t,n=document.querySelector("#enterId"),a=document.querySelector("#newitem");if(t=document.getElementById("item").checked?"item":document.getElementById("qty").checked?"qty":"price",isEmpty(n.value)){alert("Please enter the ID number of the item you wish to edit, and select an attribute to change. Please note you cannot edit other users items.");return}let l={tableId:n.value,edit:t,newitem:a.value},i=await fetch("/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),o=await i.json();generateTable(o),resetTextBoxes()};let toggleCount=1;const togglefunction=function(e){if(e.preventDefault(),e.target&&e.target.classList.contains("toggleguestlist")){let t="true"===e.target.getAttribute("aria-checked");e.target.setAttribute("aria-checked",!t),!e.target.isChecked&&toggleCount++,toggleCount%2!=0?(console.log("count: ",toggleCount),document.getElementById("names").style.visibility="visible"):toggleCount%2==0&&(document.getElementById("names").style.visibility="hidden")}},radiofunction=function(e){e.preventDefault(),e.target&&e.target.classList.contains("radio")&&e.target.setAttribute("checked","")};window.onload=function(){refreshPage();let e=document.getElementById("submit");e.onclick=submit;let t=document.getElementById("suggest");t.onclick=suggest;let n=document.getElementById("logout");n.onclick=logout;let a=document.getElementById("edit");a.onclick=edit;let l=document.querySelector(".toggleguestlist");l.addEventListener("dblclick",togglefunction,!1),document.getElementById("table"),table.addEventListener("click",function(e){if(e.preventDefault(),e.target&&e.target.classList.contains("remove")){let t=e.target.closest("tr").rowIndex-1;remove.onclick=remove(t)}});let i=document.getElementById("tableSuggest");i.addEventListener("click",function(e){if(e.preventDefault(),e.target&&e.target.classList.contains("bring")){let t=e.target.closest("tr").rowIndex-1;bring.onclick=bring(t)}})};